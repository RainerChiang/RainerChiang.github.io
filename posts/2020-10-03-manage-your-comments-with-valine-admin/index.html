<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Hugo 0.75.1" />

  <title> Valine-Admin: Manage Your Valine Comments |  Rainer Chiang</title>
  <meta name="description" content="Using valine-admin to manage comments powered by valine.">
  <link rel="stylesheet" href="https://rainerchiang.github.io/css/simpleness.css">
  <link rel="canonical" href="https://rainerchiang.github.io/posts/2020-10-03-manage-your-comments-with-valine-admin/">
  <link rel="alternate" type="application/rss+xml" href="" title="Rainer Chiang">
  
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet">
</head>

<body>
  <header class="menus">
  

  <nav >
    
    <a href="/"> Home</a>
    
    <a href="/projects/"> Projects</a>
    
    <a href="/about/"> About</a>
    
  </nav>

  <nav class="fontawesome">
    
    <a href="https://github.com/RainerChiang" target="_blank">
        <i title="GitHub" class="fab fa-github"></i>
    </a>
    
    
    <a href="https://rainerchiang.github.io/index.xml" target="_blank">
        <i title="RSS" class="fas fa-rss"></i>
    </a>
    
  </nav>
  
  
  <div class="hidden description">The blog of Rainer Chiang, he writes here sometimes.</div>
  
</header>

<article class="article">
  <header>
    <h1 style="text-align: center;" >Valine-Admin: Manage Your Valine Comments</h1>

    <div class="post-meta">
    
      <time datetime="2020-10-03T11:59:19&#43;08:00">October 03, 2020</time> &nbsp; 
    

    Rainer Chiang &nbsp;

    
    
      <i class="far fa-eye"></i>
      <span id="/posts/2020-10-03-manage-your-comments-with-valine-admin/" class="leancloud_visitors" data-flag-title="Valine-Admin: Manage Your Valine Comments">
          <span class="leancloud-visitors-count">  </span>
      </span> &nbsp;
    
    

    
      <i class="far fa-clock"></i>
      
      
      

      
        6 min
      
      30 s
      &nbsp;
    

    
      <i class="fas fa-folder"></i>
      
      <a href="/categories/whisper">Whisper</a>
      &nbsp;
      
    
    </div>
  </header>

  
  <div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#valine-admin">Valine Admin</a></li>
    <li><a href="#leancloud-国际版">LeanCloud 国际版</a></li>
    <li><a href="#valine">Valine</a></li>
    <li><a href="#配置-valine-admin">配置 Valine Admin</a>
      <ul>
        <li><a href="#评论管理系统">评论管理系统</a></li>
        <li><a href="#邮件通知">邮件通知</a></li>
      </ul>
    </li>
  </ul>
</nav>  
  </div>
   

  <div class="text">
    <h2 id="valine-admin">Valine Admin</h2>
<p>新版本的 valine 评论系统取消了对邮件通知的支持，高兴的是 <a href="https://github.com/DesertsP">DesertsP</a> 开发了针对 valine 的评论管理系统 <a href="https://github.com/DesertsP/Valine-Admin">Valine-Admin</a>。</p>
<p>但随着 LeanCloud 控制流的改版，Valine-Admin 安装文档也有点过时了，下面是我成功安装 Valine-Admin 的过程记录，以供参考。</p>
<h2 id="leancloud-国际版">LeanCloud 国际版</h2>
<p>我用的是 LeanCloud 国际版，使用邮箱即可注册，不用实名认证。</p>
<p>对一个个人静态博客来说，其免费版完全够用了。</p>
<p>注册地址是：<a href="https://console.leancloud.app/login.html#/signup">https://console.leancloud.app/login.html#/signup</a></p>
<h2 id="valine">Valine</h2>
<p>Valine 评论系统的安装和使用，请直接参考其使用文档：<a href="https://valine.js.org/">Valine - 一款快速、简洁且高效的无后端评论系统</a>。</p>
<h2 id="配置-valine-admin">配置 Valine Admin</h2>
<h3 id="评论管理系统">评论管理系统</h3>
<blockquote>
<p>内容参考自 <a href="https://deserts.io/valine-admin-document/">Valine Admin 配置手册</a></p>
</blockquote>
<ol>
<li>配置环境变量</li>
</ol>
<p>选择「云引擎」-&gt;「设置」-&gt;「自定义环境变量」，增添如下环境变量：</p>
<table>
<thead>
<tr>
<th style="text-align:left">变量</th>
<th style="text-align:left">示例</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">SITE_NAME</td>
<td style="text-align:left">Chiang&rsquo;s Blog</td>
<td style="text-align:left">[必填]博客名称</td>
</tr>
<tr>
<td style="text-align:left">SITE_URL</td>
<td style="text-align:left"><a href="https://rainerchiang.github.io">https://rainerchiang.github.io</a></td>
<td style="text-align:left">[必填]首页地址</td>
</tr>
<tr>
<td style="text-align:left"><strong>SMTP_SERVICE</strong></td>
<td style="text-align:left">QQ</td>
<td style="text-align:left">[新版支持]邮件服务提供商，支持 QQ、163、126、Gmail 以及 <a href="https://nodemailer.com/smtp/well-known/#supported-services">更多</a></td>
</tr>
<tr>
<td style="text-align:left">SMTP_USER</td>
<td style="text-align:left"><a href="mailto:xyz@qq.com">xyz@qq.com</a></td>
<td style="text-align:left">[必填]SMTP登录用户</td>
</tr>
<tr>
<td style="text-align:left">SMTP_PASS</td>
<td style="text-align:left">xyzPasswd</td>
<td style="text-align:left">[必填]SMTP登录密码（QQ邮箱需要获取独立密码）</td>
</tr>
<tr>
<td style="text-align:left">SENDER_NAME</td>
<td style="text-align:left">Rainer Chiang</td>
<td style="text-align:left">[必填]发件人</td>
</tr>
<tr>
<td style="text-align:left">SENDER_EMAIL</td>
<td style="text-align:left"><a href="mailto:xyz@qq.com">xyz@qq.com</a></td>
<td style="text-align:left">[必填]发件邮箱</td>
</tr>
<tr>
<td style="text-align:left">ADMIN_URL</td>
<td style="text-align:left"><a href="https://xyz.avosapps.us">https://xyz.avosapps.us</a></td>
<td style="text-align:left">[建议]Web主机二级域名，用于自动唤醒</td>
</tr>
</tbody>
</table>
<p>注意：</p>
<ul>
<li><code>SITE_URL</code> 结尾不要添加斜杠 <code>/</code></li>
<li>这里 <code>SMTP_USER</code> 和 <code>SENDER_EMAIL</code> 字段须是同一邮箱</li>
<li><code>ADMIN_URL</code> 在「云引擎」-&gt;「设置」-&gt;「云引擎域名」中设置添加，如图所示。这项 URL 用于进入评论管理界面。</li>
</ul>
<p><img src="https://i.loli.net/2020/10/03/Q519Kg8uLD7XsNM.png" alt="cloud-engin.png"></p>
<ol start="2">
<li>部署 Valine-Admin 的代码到云引擎中</li>
</ol>
<p><img src="https://i.loli.net/2020/10/03/4J6hV7vA3ReXgkL.png" alt="deploy.png"></p>
<p><img src="https://i.loli.net/2020/10/03/WhM8tNHU4xVgDuP.png" alt="deploy1.png"></p>
<p>如图所示，进入控制台后，选择「云引擎」-&gt;「部署」-&gt;「部署项目」-&gt;「Git部署」，点击「配置Git」，粘贴并保存 Valine-Admin 的项目地址 <code>https://github.com/DesertsP/Valine-Admin.git</code>。</p>
<p><img src="https://i.loli.net/2020/10/03/Su6MqircltBv7Yj.png" alt="deploy2.png"></p>
<p>完成后，在「手动部署」中点击部署即可。</p>
<ol start="3">
<li>进入评论管理</li>
</ol>
<p>首先通过你设置的 <code>ADMIN_URL</code> 链接再加上 <code>/sign-up</code> 进入账号设置界面，即 <code>https://xyz.avosapps.us/sign-up</code>。</p>
<p>在设置好账号和密码后，即可登录评论管理界面，如下所示：</p>
<p><img src="https://i.loli.net/2020/10/03/auCbD1Wxtil4POr.png" alt="comments.png"></p>
<ol start="4">
<li>定时任务</li>
</ol>
<p>详细参见 <a href="https://deserts.io/valine-admin-document/">Valine Admin Document</a>，不过由于 LeanCloud 后来又更改了 <a href="https://leancloud.cn/docs/leanengine_plan.html#hash633315134">休眠策略</a>，定时任务策略已经不再起效。</p>
<p>可以通过查看云引擎的日志，查看相关记录。</p>
<h3 id="邮件通知">邮件通知</h3>
<p>在设置好评论管理系统后，还需要设置通知邮件模板，以便发送通知邮件。</p>
<ol>
<li>再次回到环境变量设置，添加如下环境变量</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:left">变量</th>
<th style="text-align:left">示例</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">MAIL_SUBJECT</td>
<td style="text-align:left">${PARENT_NICK}，您在 ${SITE_NAME} 上的评论收到了回复</td>
<td style="text-align:left">[可选]@通知邮件主题（标题）模板</td>
</tr>
<tr>
<td style="text-align:left">MAIL_TEMPLATE</td>
<td style="text-align:left">见下文 HTML 代码</td>
<td style="text-align:left">[可选]@通知邮件内容模板</td>
</tr>
<tr>
<td style="text-align:left">MAIL_SUBJECT_ADMIN</td>
<td style="text-align:left">${SITE_NAME} 上有新评论了</td>
<td style="text-align:left">[可选]博主邮件通知主题模板</td>
</tr>
<tr>
<td style="text-align:left">MAIL_TEMPLATE_ADMIN</td>
<td style="text-align:left">见下文 HTML 代码</td>
<td style="text-align:left">[可选]博主邮件通知内容模板</td>
</tr>
</tbody>
</table>
<p><code>MAIL_TEMPLATE</code> 模板代码如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-top:2px solid #12ADDB;box-shadow:0 1px 3px #AAAAAA;line-height:180%;padding:0 15px 12px;margin:50px auto;font-size:12px;&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>	&lt;<span style="color:#f92672">h2</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-bottom:1px solid #DDD;font-size:14px;font-weight:normal;padding:13px 0 10px 8px;&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>		您在&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-decoration:none;color: #12ADDB;&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${SITE_URL}&#34;</span> <span style="color:#a6e22e">target</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_blank&#34;</span>&gt; ${SITE_NAME} &lt;/<span style="color:#f92672">a</span>&gt;上的评论有了新的回复
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>	&lt;/<span style="color:#f92672">h2</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>	${PARENT_NICK} 同学，您曾发表评论：
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>	&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;padding:0 12px 0 12px;margin-top:18px&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>		&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-color: #f5f5f5;padding: 10px 15px;margin:18px 0;word-wrap:break-word;&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>			 ${PARENT_COMMENT} 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>		&lt;/<span style="color:#f92672">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>		&lt;<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">strong</span>&gt; ${NICK} &lt;/<span style="color:#f92672">strong</span>&gt;回复说：&lt;/<span style="color:#f92672">p</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>		&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-color: #f5f5f5;padding: 10px 15px;margin:18px 0;word-wrap:break-word;&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>			${COMMENT}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>		&lt;/<span style="color:#f92672">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>		&lt;<span style="color:#f92672">p</span>&gt;您可以点击&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-decoration:none; color:#12addb&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${POST_URL}&#34;</span> <span style="color:#a6e22e">target</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_blank&#34;</span>&gt; 查看回复的完整內容&lt;/<span style="color:#f92672">a</span>&gt;，欢迎再次光临
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>			&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-decoration:none; color:#12addb&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${SITE_URL}&#34;</span> <span style="color:#a6e22e">target</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_blank&#34;</span>&gt; ${SITE_NAME}&lt;/<span style="color:#f92672">a</span>&gt;。
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>			&lt;<span style="color:#f92672">br</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>		&lt;/<span style="color:#f92672">p</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>	&lt;/<span style="color:#f92672">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>&lt;/<span style="color:#f92672">div</span>&gt;
</code></pre></div><p><code>MAIL_TEMPLATE_ADMIN</code> 模板代码如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-top:2px solid #12ADDB;box-shadow:0 1px 3px #AAAAAA;line-height:180%;padding:0 15px 12px;margin:50px auto;font-size:12px;&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>	&lt;<span style="color:#f92672">h2</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;border-bottom:1px solid #DDD;font-size:14px;font-weight:normal;padding:13px 0 10px 8px;&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>		您在&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-decoration:none;color: #12ADDB;&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${SITE_URL}&#34;</span> <span style="color:#a6e22e">target</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_blank&#34;</span>&gt; ${SITE_NAME} &lt;/<span style="color:#f92672">a</span>&gt;上的文章有了新的评论
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>	&lt;/<span style="color:#f92672">h2</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>	&lt;<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">strong</span>&gt; ${NICK} &lt;/<span style="color:#f92672">strong</span>&gt;回复说：&lt;/<span style="color:#f92672">p</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>	&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;background-color: #f5f5f5;padding: 10px 15px;margin:18px 0;word-wrap:break-word;&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>		${COMMENT}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>	&lt;/<span style="color:#f92672">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>	&lt;<span style="color:#f92672">p</span>&gt;您可以点击&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">style</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text-decoration:none; color:#12addb&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;${POST_URL}&#34;</span> <span style="color:#a6e22e">target</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;_blank&#34;</span>&gt; 查看回复的完整內容 &lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">br</span>&gt;&lt;/<span style="color:#f92672">p</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>	&lt;/<span style="color:#f92672">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>&lt;/<span style="color:#f92672">div</span>&gt;
</code></pre></div><ol start="2">
<li>回到部署，点击 <strong>重启</strong>。</li>
</ol>
<p>到此，完成全部的安装操作，可以愉快地使用 Valine 评论系统了。</p>

  </div>

  <footer>
    <hr class="end-line">

    

    
    <div class="post-tags">
      <i class="fas fa-tags"></i>
      
        <a href="/tags/hugo">Hugo</a>
        &nbsp;
      
        <a href="/tags/valine-admin">Valine-Admin</a>
        &nbsp;
      
    </div>
    

    
    
    <div class="releated-posts">
      <h3>Related Posts</h3>
      
      <i class="fas fa-paperclip"></i>
      <a href="/posts/2020-09-22-hello-hugo/">Hello Hugo</a>
      <br>
      
    </div>
    
  </footer>

  <div class="comments">



  <div class="comments-item comments-valine" >
    
    
    
    <div id="vcomments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
    <script type="text/javascript">
      new Valine({
          el: '#vcomments',
          highlight: false,
          lang: "en",
          appId: "CXhRxgF18xcqkQ6ylD56iJC5-MdYXbMMI",
          appKey: "N0uSp4sS3sxcEbaFgINUHYiy",
          placeholder: "Say Something......",
          requiredFields: ["nick","mail"],
          avatar: "robohash",
          visitor:  true ,
          recordIP: true
      });
    </script>
    <script>
      if(window.location.hash){
          var checkExist = setInterval(function() {
             if ($(window.location.hash).length) {
                $('html, body, article').animate({scrollTop: $(window.location.hash).offset().top-90}, 1000);
                clearInterval(checkExist);
             }
          }, 100);
      }
    </script>
  </div>

</div>

</article>


</body>
<div class="foot">
  
  
    &copy; 2020 - 2020 &#183; 
    <a href="/">Rainer Chiang</a> · Theme <a href="https://github.com/RainerChiang/simpleness">Simpleness</a> Powered by <a href="https://gohugo.io/">Hugo</a> &#183;
    <a href="#"><i class="fas fa-chevron-up"></i></a>
  

  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-162425220-2', 'auto');
	
	ga('send', 'pageview');
}
</script>

  
</div>

<script src="/js/lazyload.min.js"></script>
<script>
  var lazyImage = new LazyLoad({
    container: document.getElementById('article')
  });
</script>


</html>
